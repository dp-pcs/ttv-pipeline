<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTV Pipeline Launcher</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .launcher {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 3rem;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
        }
        
        .logo {
            font-size: 4rem;
            margin-bottom: 1rem;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        
        .status {
            background: rgba(0, 0, 0, 0.2);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            font-family: monospace;
            font-size: 0.9rem;
            min-height: 100px;
            overflow-y: auto;
            text-align: left;
        }
        
        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.5rem;
            min-width: 150px;
        }
        
        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn.primary {
            background: #10b981;
            border-color: #10b981;
        }
        
        .btn.primary:hover {
            background: #059669;
            border-color: #059669;
        }
        
        .instructions {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .hidden {
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spinning {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="launcher">
        <div class="logo">üé¨</div>
        <h1>TTV Pipeline</h1>
        <p class="subtitle">AI-Powered Video Generation Studio</p>
        
        <div id="status" class="status">
            <div>Welcome! Click "Start System" to begin...</div>
        </div>
        
        <div class="controls">
            <button id="start-btn" class="btn primary" onclick="startSystem()">
                <span id="start-icon">üöÄ</span> Start System
            </button>
            <button id="open-btn" class="btn hidden" onclick="openApp()">
                üì± Open TTV Studio
            </button>
            <button id="stop-btn" class="btn hidden" onclick="stopSystem()">
                üõë Stop System
            </button>
        </div>
        
        <div class="instructions">
            <strong>First Time Setup:</strong><br>
            1. Click "Start System" to launch the backend<br>
            2. Open TTV Studio when ready<br>
            3. Configure your API keys in Settings<br>
            4. Start creating amazing videos!
        </div>
    </div>

    <script>
        let statusCheckInterval;
        let isSystemRunning = false;

        function log(message) {
            const status = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            status.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            status.scrollTop = status.scrollHeight;
        }

        function updateButtons(starting = false, running = false) {
            const startBtn = document.getElementById('start-btn');
            const openBtn = document.getElementById('open-btn');
            const stopBtn = document.getElementById('stop-btn');
            const startIcon = document.getElementById('start-icon');
            
            if (starting) {
                startBtn.disabled = true;
                startBtn.innerHTML = '<span class="spinning">‚öôÔ∏è</span> Starting...';
                openBtn.classList.add('hidden');
                stopBtn.classList.add('hidden');
            } else if (running) {
                startBtn.classList.add('hidden');
                openBtn.classList.remove('hidden');
                stopBtn.classList.remove('hidden');
                isSystemRunning = true;
            } else {
                startBtn.disabled = false;
                startBtn.innerHTML = '<span>üöÄ</span> Start System';
                startBtn.classList.remove('hidden');
                openBtn.classList.add('hidden');
                stopBtn.classList.add('hidden');
                isSystemRunning = false;
            }
        }

        async function checkBackendStatus() {
            try {
                const response = await fetch('http://localhost:8000/healthz');
                if (response.ok) {
                    return true;
                }
            } catch (error) {
                // Backend not running
            }
            return false;
        }

        async function startSystem() {
            updateButtons(true);
            log('Starting TTV Pipeline system...');
            
            try {
                // Check if Docker is running
                log('Checking Docker...');
                
                // In a real implementation, this would execute Docker commands
                // For now, we'll simulate the startup process
                
                log('Starting Redis...');
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                log('Starting API Server...');
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                log('Starting Worker...');
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                log('Checking system health...');
                
                // Start checking for backend
                let attempts = 0;
                const maxAttempts = 30;
                
                const checkLoop = async () => {
                    attempts++;
                    const isRunning = await checkBackendStatus();
                    
                    if (isRunning) {
                        log('‚úÖ System is ready!');
                        updateButtons(false, true);
                        startStatusMonitoring();
                    } else if (attempts < maxAttempts) {
                        log(`Waiting for system... (${attempts}/${maxAttempts})`);
                        setTimeout(checkLoop, 2000);
                    } else {
                        log('‚ùå System failed to start. Please check Docker and try again.');
                        updateButtons(false, false);
                    }
                };
                
                checkLoop();
                
            } catch (error) {
                log(`‚ùå Error starting system: ${error.message}`);
                updateButtons(false, false);
            }
        }

        function startStatusMonitoring() {
            statusCheckInterval = setInterval(async () => {
                const isRunning = await checkBackendStatus();
                if (!isRunning && isSystemRunning) {
                    log('‚ö†Ô∏è System appears to have stopped');
                    updateButtons(false, false);
                    stopStatusMonitoring();
                }
            }, 10000); // Check every 10 seconds
        }

        function stopStatusMonitoring() {
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
                statusCheckInterval = null;
            }
        }

        function openApp() {
            log('Opening TTV Studio...');
            window.open('index.html', '_blank');
        }

        async function stopSystem() {
            log('Stopping TTV Pipeline system...');
            
            try {
                // In a real implementation, this would stop Docker containers
                log('Stopping containers...');
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                log('‚úÖ System stopped successfully');
                updateButtons(false, false);
                stopStatusMonitoring();
                
            } catch (error) {
                log(`‚ùå Error stopping system: ${error.message}`);
            }
        }

        // Auto-check on load
        window.addEventListener('load', async () => {
            log('Checking if system is already running...');
            const isRunning = await checkBackendStatus();
            
            if (isRunning) {
                log('‚úÖ System is already running!');
                updateButtons(false, true);
                startStatusMonitoring();
            } else {
                log('System is not running. Click "Start System" to begin.');
            }
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            stopStatusMonitoring();
        });
    </script>
</body>
</html>
